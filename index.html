<!DOCTYPE html>

<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
</head>
<body>  

<script>

  var url = "https://api.openai.com/v1/engines/text-davinci-003/completions";
  var myInterval,startTime;
    var QAs = [];
    var answers=[];
    var qindex = 0;  
    var q = 0;
    

    function askAI(Questions) {
        
        question = 'grade this (0-10) and explain: '+ JSON.stringify(Questions[q]);
        $.ajax({
            url: "https://script.google.com/macros/s/AKfycbxtKsYrWU586A2O2sVJf0bg71dT0N1fVuBWIJlDCcmmlABCUKyM1rOdsyjwUp_tUjSs/exec?AskAI="+question,
            type: 'GET',
            complete: function() {
            q++;
            if (q<=QAs.length) {
                
                //console.log("calling one more");
                askAI(Questions);
            }
            },
            success: function(result) {
                $("#result").html($("#result").html()+ "<hr><p> Question " +q+ ":" + Questions[q][0]+ "</p><p><b>Answer :</b>" + Questions[q][1] + " </p><br> Grade: " + result +"</p>");
            //console.log("Download Success ");
            }
        });
    }
    function getAI_q(topic){
            url = "https://script.google.com/macros/s/AKfycbxtKsYrWU586A2O2sVJf0bg71dT0N1fVuBWIJlDCcmmlABCUKyM1rOdsyjwUp_tUjSs/exec?AskAI= 10 interview questions on "+topic +" each seperated by '@@'";
            $.get(url,function(data){
                QAs = (data.split("@@"));
                console.log(QAs);
            })
    }
    function getQA(){
       qindex = 0;
       url ="https://script.google.com/macros/s/AKfycbxXmNBMnHqOPB4I0_kBANDb5nv80RJ8cyN5vqJMAsc-sVBivalJfy4hwRJUiqYtiKSn/exec?getQA";
	$("#result").html("Loading..." );
       $.get(url, function(data){
               
                QAs = (JSON.parse(data));
               
           
                showNext();
               
						});

       
  }
  
   function showNext(){
    $("#result").css('opacity','0');
   
    if(qindex < QAs.length){
    
	if(qindex !==0){
	 answers.push([QAs[qindex][0],$("#prompt_div").val()]);
    $("#result").html("<div style='margin:5px;color:grey;background:#eff'><b>Prev question </b>:"+ QAs[qindex-1][0] + "<br> <b>Best Answer</b> : "+  QAs[qindex-1][1] +" <br></div><hr><b>Your next question</B>: "+ QAs[qindex][0] );
    $("#result").css('opacity','1');
      }else{

	 $("#result").html(" <b>Your first question</b>: "+ QAs[qindex][0] );
          $("#result").css('opacity','1');
	}
    qindex++;
    }else{
       $("#result").html("That ends your test");
        //$("#result").html(JSON.stringify(answers));
         $("#result").css('opacity','1');
         $("#result").html("AI is checking your answers...");
         
		 askAI(QAs);
    }
    

  }
    function displayWaitTime() {
            var currentTime = new Date().getTime();
            var waitTime = Math.round((currentTime - startTime)/1000);
            document.getElementById("result").value = ("Working on this for : " + waitTime + " seconds");
    }

 

  

</script>
	
    <video id="video" width="640" height="480" autoplay></video>
  
    <script>
   const video = document.getElementById('video');
	navigator.mediaDevices.getUserMedia({video: true})
	  .then(stream => {
	    video.srcObject = stream;
	  });
   
function start_recording(){
  const chunks = [];
  const mediaRecorder = new MediaRecorder(video.srcObject);
  mediaRecorder.ondataavailable = event => chunks.push(event.data);
  mediaRecorder.onstop = () => {
    const blob = new Blob(chunks, {type: 'video/mp4'});
    const formData = new FormData();
    formData.append('video', blob, 'myvideo.mp4');
    // Upload formData to server using XMLHttpRequest or fetch()
  };
  mediaRecorder.start();
}
function stop_recording(){	    
    mediaRecorder.stop();
 
};
    </script>
    <button id="start-recording" onclick="start_recording()">Record</button>
 	
 	 
<div id='result' style="height: 200px;width: 80%;font-size: 14px;font-family:helvetica;overflow:auto;"><button id="get" onclick="getQA()">Start</button></div>

<br><button id="send" onclick="showNext()">Send</button><br>

<textarea id="prompt_div" style="height: 300px;width: 80%;font-size: 14px;font-family:helvetica"></textarea>
</body>  
</html>

  </body>
</html>

