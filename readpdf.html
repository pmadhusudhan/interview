<!DOCTYPE html>
<html>
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	</head>

	<body>
       
		<h1>AI scan of any of your document</h1>
		Load your pdf here to understand it in easily understandable language.
		 <input type="file" id="pdf-file">
		
		<button onclick="getSummary()">Summarize</button>
		<div style="width:50%; height:600px;overflow:auto" id="text-area"></div>
		<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

		

		<script>
			pdfjsLib.GlobalWorkerOptions.workerSrc =
				'https://mozilla.github.io/pdf.js/build/pdf.worker.js';

			async function extractText(pdfUrl) {
				var pdf = pdfjsLib.getDocument(pdfUrl);
				return pdf.promise.then(function (pdf) {
					var totalPageCount = pdf.numPages;
					var countPromises = [];
					for (
						var currentPage = 1;
						currentPage <= totalPageCount;
						currentPage++
					) {
						var page = pdf.getPage(currentPage);
						countPromises.push(
							page.then(function (page) {
								var textContent = page.getTextContent();
								return textContent.then(function (text) {
									return text.items
										.map(function (s) {
											return s.str;
										})
										.join('');
								});
							}),
						);
					}

					return Promise.all(countPromises).then(function (texts) {
						return texts.join('');
					});
				});
			}

			
			const element = document.getElementById('pdf-file');
			const textarea = document.getElementById('text-area');
            
			element.addEventListener('change', function () {
				const file = element.files[0];
				const reader = new FileReader();

				reader.onload = function (event) {
					const pdfUrl = event.target.result;
					
                    extractText(pdfUrl).then(
                        function (text) {
                            textarea.innerHTML = text;
			    //getSummary(text);
                        },
                        function (reason) {
                            console.error(reason);
                        },
			        );
					//textarea.value = text;
				};

				reader.readAsArrayBuffer(file);
			});
		function getSummary(){
			selection = window.getSelection();
    			selectedtext = selection.toString();
    			if(selectedtext !== ""){

    			}else{
			selectedtext = $('#text-area').html();
			}
			question = "summarize in easy to understand bullet points";
			
			    if($("#ai_display").length > 0){
			      $("#ai_display").html("Loading AI response for : "+question +"<img src='https://cdn.dribbble.com/users/720991/screenshots/4945468/ava1_loader.gif' width='150px' height='50px' /><p><div>Preview</div>"+selectedtext+"</p>");
			    }else{
			      $("body").append("<div style='line-height:1.2 !important;font-size:14px;background:black;width:50%;height:800px;z-index:99999;position:fixed;top:0px;right:0px'></div><div id='ai_display' style='padding:50px;overflow:auto;position:fixed;z-index:999999999;top:10%;width:50%;right:0%;height:800px;background:white;'>Loading AI response for : "+question +"<img src='https://cdn.dribbble.com/users/720991/screenshots/4945468/ava1_loader.gif' width='150px' height='50px' /><p><div>Preview</div>"+selectedtext+"</p></div>");
			    
			    }
						
			$.ajax({
			        url: "https://askai-node-ndmd3ghqma-ue.a.run.app",
			        type: 'POST',
			        data: JSON.stringify({q:question +": #transcript:"+ selectedtext.substr(0,3000)}),
			        contentType: "application/json",
			        complete: function() {
			          $("#ai_display").html();
			        },
		        success: function(result) {
		          result = result.replace(/[0-9]+\./g, "\n");
		          
			// Replace using regex with newline character + number + "."
		       
		          if($("#ai_display").length > 0){
		            $("#ai_display").html("<textarea style='width:100%;height:600px;font-size: 16px;font-family:Helvetica;border:none;'>"+result+"</textarea>");
		          }
		             
		        }
		    });
		}
		</script>

		
	</body>
</html>
